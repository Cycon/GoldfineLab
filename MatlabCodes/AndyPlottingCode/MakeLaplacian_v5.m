function data=MakeLaplacian(dataOriginal,channels)
%
%New version 5/17/11 that uses cofl_xtp_makemont to make laplacian montage
%dynamically. Give data organized as channels x data x trials.
%Then channels is either cell array list of channels or an EEGLAB chanlocs structure.
%Important that all channels are represented in eegp_defopts which is where
%their locations are specified.
%version 2 has new lead locations
%version 3 allows for normalization by total power, requires params.Fs at
%minimum
%version 4 11/15/11 option to run on the EGI array (initially used with
%Srvivas's data but meant for our 129 headcap too)
%version 5 12/13/11 will ignore channels not located on head (like acc).
%Determined by EEG.chanlocs.X=NaN (done in importAccEeglab and JV's
%chanlocs code). Requires chanlocs as the second input obviously.

%note if you use a(:,:,:) for a 2 D array it works fine.

if ndims(dataOriginal)>3 || size(dataOriginal,1)~=length(channels)
    disp('Data for MakeLaplacian needs to be channelsxdata points (x epochs)');
end

%initialize data so can put in the non-EEG channels immediately
data=zeros(size(dataOriginal));
EEG_ch= true(1,size(dataOriginal,1));%make a logical vector of 1s for EEG channels

%first convert chanlocs structure into a cell array
if isstruct(channels)
    channelsCell=struct2cell(channels);
    chan=squeeze(channelsCell(1,1,:));%names of channels in a cell array
    
    %determine which channels aren't EEG
    EEG_ch(isnan([channels.X]))=false;%logical index of non-EEG channels
    data(~EEG_ch,:,:)=dataOriginal(~EEG_ch,:,:);%fill in those rows
end

%remove extra rows
    dataOriginal(~EEG_ch,:,:)=[];
   
%%
%here multiply my 3d matrix (each 3rd Dimension) by JV's Hjorth multiplier
%ensuring only channels present are ones I'm interested in. 


%Hjorth matrices have the output in rows and input in columns (confirmed 5/17/11
%by having fewer outputs than inputs). You are reordering the columns of the data so it goes on the right.  So I put Hjorth
%matrix on the left and my data on the right as it is channels x data. Can't multiply by whole 3D
%matrix so need to multiply one snippet at a time.


% dataHjorthOrder=zeros(size(eegDataReordered));
% for i=1:size(eegDataReordered,3) %for each snippet
%     dataHjorthOrder(:,:,i)=Hjorth*eegDataReordered(:,:,i);
% end

%make HjorthAbsRescaled Matrix
opts.mont_mode='Laplacian';%there's a bipolar version but don't know how to get it to work

opts.Laplacian_type='HjorthAbsRescaled'; %also could do Hjorth, HjorthAbs and two others wth Qua

%  opts.Laplacian_type='ParabAbsRescaled'; 
%    opts.Laplacian_type='GenqAbsRescaled'; %gives weird results 5/26/11 so don't use
%  if strcmpi(opts.Laplacian_type,'GenqAbsRescaled') %required to fit the model
%      opts.Laplacian_nbrs_interior=6;
%      opts.Laplacian_nbrs_edge=5;
%  end
fprintf('Using %s montage\n',opts.Laplacian_type);
%%
%below is my original version, but not incoporated into
%eegp_defopts_eeglablocs;
% %this is lead list from EEGLAB MNI 10-5 system.
% loc=[-86.0761000000000,-19.9897000000000,-47.9860000000000;85.7939000000000,-20.0093000000000,-48.0310000000000;0.00830000000000000,86.8110000000000,-39.9830000000000;-29.4367000000000,83.9171000000000,-6.99000000000000;0.112300000000000,88.2470000000000,-1.71300000000000;29.8723000000000,84.8959000000000,-7.08000000000000;-48.9708000000000,64.0872000000000,-47.6830000000000;-54.8397000000000,68.5722000000000,-10.5900000000000;-45.4307000000000,72.8622000000000,5.97800000000000;-33.7007000000000,76.8371000000000,21.2270000000000;-18.4717000000000,79.9041000000000,32.7520000000000;0.231300000000000,80.7710000000000,35.4170000000000;19.8203000000000,80.3019000000000,32.7640000000000;35.7123000000000,77.7259000000000,21.9560000000000;46.5843000000000,73.8078000000000,6.03400000000000;55.7433000000000,69.6568000000000,-10.7550000000000;50.4352000000000,63.8698000000000,-48.0050000000000;-70.1019000000000,41.6523000000000,-49.9520000000000;-70.2629000000000,42.4743000000000,-11.4200000000000;-64.4658000000000,48.0353000000000,16.9210000000000;-50.2438000000000,53.1112000000000,42.1920000000000;-27.4958000000000,56.9311000000000,60.3420000000000;0.312200000000000,58.5120000000000,66.4620000000000;29.5142000000000,57.6019000000000,59.5400000000000;51.8362000000000,54.3048000000000,40.8140000000000;67.9142000000000,49.8297000000000,16.3670000000000;73.0431000000000,44.4217000000000,-12;72.1141000000000,42.0667000000000,-50.4520000000000;-84.0759000000000,14.5673000000000,-50.4290000000000;-80.7750000000000,14.1203000000000,-11.1350000000000;-77.2149000000000,18.6433000000000,24.4600000000000;-60.1819000000000,22.7162000000000,55.5440000000000;-34.0619000000000,26.0111000000000,79.9870000000000;0.376100000000000,27.3900000000000,88.6680000000000;34.7841000000000,26.4379000000000,78.8080000000000;62.2931000000000,23.7228000000000,55.6300000000000;79.5341000000000,19.9357000000000,24.4380000000000;81.8151000000000,15.4167000000000,-11.3300000000000;84.1131000000000,14.3647000000000,-50.5380000000000;-85.8941000000000,-15.8287000000000,-48.2830000000000;-84.1611000000000,-16.0187000000000,-9.34600000000000;-80.2801000000000,-13.7597000000000,29.1600000000000;-65.3581000000000,-11.6317000000000,64.3580000000000;-36.1580000000000,-9.98390000000000,89.7520000000000;0.400900000000000,-9.16700000000000,100.244000000000;37.6720000000000,-9.62410000000000,88.4120000000000;67.1179000000000,-10.9003000000000,63.5800000000000;83.4559000000000,-12.7763000000000,29.2080000000000;85.0799000000000,-15.0203000000000,-9.49000000000000;85.5599000000000,-16.3613000000000,-48.2710000000000;-85.6192000000000,-46.5147000000000,-45.7070000000000;-84.8302000000000,-46.0217000000000,-7.05600000000000;-79.5922000000000,-46.5507000000000,30.9490000000000;-63.5562000000000,-47.0088000000000,65.6240000000000;-35.5131000000000,-47.2919000000000,91.3150000000000;0.385800000000000,-47.3180000000000,99.4320000000000;38.3838000000000,-47.0731000000000,90.6950000000000;66.6118000000000,-46.6372000000000,65.5800000000000;83.3218000000000,-46.1013000000000,31.2060000000000;85.5488000000000,-45.5453000000000,-7.13000000000000;86.1618000000000,-47.0353000000000,-45.8690000000000;-73.0093000000000,-73.7657000000000,-40.9980000000000;-72.4343000000000,-73.4527000000000,-2.48700000000000;-67.2723000000000,-76.2907000000000,28.3820000000000;-53.0073000000000,-78.7878000000000,55.9400000000000;-28.6203000000000,-80.5249000000000,75.4360000000000;0.324700000000000,-81.1150000000000,82.6150000000000;31.9197000000000,-80.4871000000000,76.7160000000000;55.6667000000000,-78.5602000000000,56.5610000000000;67.8877000000000,-75.9043000000000,28.0910000000000;73.0557000000000,-73.0683000000000,-2.54000000000000;73.8947000000000,-74.3903000000000,-41.2200000000000;-54.9104000000000,-98.0448000000000,-35.4650000000000;-54.8404000000000,-97.5279000000000,2.79200000000000;-48.4244000000000,-99.3408000000000,21.5990000000000;-36.5114000000000,-100.852900000000,37.1670000000000;-18.9724000000000,-101.768000000000,46.5360000000000;0.215600000000000,-102.178000000000,50.6080000000000;19.8776000000000,-101.793000000000,46.3930000000000;36.7816000000000,-100.849100000000,36.3970000000000;49.8196000000000,-99.4461000000000,21.7270000000000;55.6666000000000,-97.6251000000000,2.73000000000000;54.9876000000000,-98.0911000000000,-35.5410000000000;-29.4134000000000,-112.449000000000,8.83900000000000;0.107600000000000,-114.892000000000,14.6570000000000;29.8426000000000,-112.156000000000,8.80000000000000;-29.8184000000000,-114.570000000000,-29.2160000000000;0.00450000000000000,-118.565000000000,-23.0780000000000;29.7416000000000,-114.260000000000,-29.2560000000000;-43.2897000000000,75.8552000000000,-28.2440000000000;-38.5517000000000,79.9532000000000,-4.99500000000000;-27.9857000000000,82.4591000000000,2.70200000000000;-17.1947000000000,84.8491000000000,10.0270000000000;-5.93170000000000,86.8780000000000,16.2000000000000;7.10530000000000,87.0740000000000,16.4690000000000;18.9233000000000,85.5969000000000,11.4430000000000;28.6443000000000,82.9759000000000,2.82800000000000;39.3203000000000,80.6868000000000,-4.72500000000000;43.8223000000000,76.5418000000000,-28.3070000000000;-63.2538000000000,53.8573000000000,-30.3160000000000;-61.3508000000000,58.7992000000000,0.897000000000000;-50.7998000000000,64.0412000000000,23.0890000000000;-34.3157000000000,68.3931000000000,41.1880000000000;-11.4357000000000,70.7561000000000,50.3480000000000;13.4793000000000,71.2010000000000,51.1750000000000;36.1833000000000,69.1509000000000,41.2540000000000;52.3972000000000,65.0708000000000,22.8620000000000;62.9152000000000,60.0448000000000,0.630000000000000;64.3342000000000,54.5998000000000,-30.4440000000000;-79.0669000000000,28.0813000000000,-31.2530000000000;-74.4999000000000,31.3003000000000,4.84600000000000;-65.2379000000000,36.4282000000000,36.1440000000000;-44.4098000000000,40.7622000000000,61.6900000000000;-15.4238000000000,43.6600000000000,77.6820000000000;17.5922000000000,44.0540000000000,77.7880000000000;45.8532000000000,41.6228000000000,60.6470000000000;67.1281000000000,37.7998000000000,35.2960000000000;78.0531000000000,32.9817000000000,4.48300000000000;80.0971000000000,28.5137000000000,-31.3380000000000;-84.1250000000000,-1.84670000000000,-29.7940000000000;-82.3550000000000,0.826300000000000,8.57900000000000;-74.6920000000000,4.30330000000000,45.3070000000000;-51.0509000000000,7.17720000000000,74.3770000000000;-18.2190000000000,9.09410000000000,92.5290000000000;18.7870000000000,9.24790000000000,91.5620000000000;51.8851000000000,7.79780000000000,73.5070000000000;77.0020000000000,5.33570000000000,45.3500000000000;83.8880000000000,1.94570000000000,8.50100000000000;84.1230000000000,-1.80830000000000,-29.6380000000000;-86.9731000000000,-32.2157000000000,-27.8480000000000;-85.5651000000000,-30.6287000000000,11.1530000000000;-76.4071000000000,-29.7307000000000,49.2170000000000;-52.9281000000000,-28.9058000000000,80.3040000000000;-18.3541000000000,-28.3219000000000,98.2200000000000;20.2199000000000,-28.1481000000000,98.1720000000000;55.1139000000000,-28.3862000000000,80.4740000000000;79.0059000000000,-28.9863000000000,49.6280000000000;85.9999000000000,-29.8203000000000,11.2480000000000;88.6249000000000,-32.2723000000000,-28;-78.1602000000000,-60.7567000000000,-23.8240000000000;-76.6802000000000,-60.8317000000000,12.8800000000000;-68.1152000000000,-62.9747000000000,47.2520000000000;-46.9142000000000,-64.6908000000000,75.2960000000000;-15.8202000000000,-65.5999000000000,91.1640000000000;19.4198000000000,-65.5950000000000,92.4050000000000;50.6738000000000,-64.4822000000000,76.1300000000000;71.0958000000000,-62.6243000000000,47.3280000000000;78.5198000000000,-60.4323000000000,12.9020000000000;78.9027000000000,-60.9553000000000,-23.8050000000000;-64.5973000000000,-87.6558000000000,-19.0140000000000;-62.9593000000000,-87.5028000000000,12.9520000000000;-54.0103000000000,-89.8988000000000,37.3320000000000;-35.8874000000000,-91.6669000000000,55.5040000000000;-12.0474000000000,-92.6069000000000,65.5080000000000;13.9226000000000,-92.6940000000000,66.9580000000000;37.7986000000000,-91.6291000000000,56.7330000000000;54.6087000000000,-89.6402000000000,37.0350000000000;63.1117000000000,-87.2282000000000,12.8560000000000;65.0137000000000,-87.8062000000000,-18.9520000000000;-42.8624000000000,-108.073000000000,-13.1510000000000;-40.1204000000000,-107.129000000000,12.0610000000000;-31.9514000000000,-108.252000000000,23.0470000000000;-19.8624000000000,-108.942000000000,29.7600000000000;-6.91940000000000,-109.260000000000,32.7100000000000;6.80360000000000,-109.163000000000,31.5820000000000;20.2936000000000,-108.914000000000,28.9440000000000;32.1756000000000,-108.252000000000,22.2550000000000;41.0976000000000,-107.245000000000,12.1380000000000;43.8946000000000,-109.127000000000,-13.1700000000000;-14.8504000000000,-117.987000000000,-6.92000000000000;15.0946000000000,-118.018000000000,-6.93300000000000;-14.8107000000000,87.2351000000000,-4.47700000000000;15.1623000000000,88.0910000000000,-4.55100000000000;-54.8298000000000,66.4132000000000,-29.7040000000000;-51.1757000000000,70.8362000000000,-1.75500000000000;-39.6407000000000,74.8671000000000,13.6780000000000;-27.2187000000000,78.7091000000000,28.3750000000000;-9.19770000000000,80.6051000000000,35.1330000000000;10.4823000000000,80.8650000000000,35.3590000000000;28.5803000000000,79.3029000000000,28.4700000000000;40.9403000000000,75.7399000000000,13.8600000000000;52.0293000000000,71.8468000000000,-1.92000000000000;55.7542000000000,67.1698000000000,-29.8240000000000;-71.5079000000000,41.1193000000000,-30.8540000000000;-68.5558000000000,45.2843000000000,3.00200000000000;-58.4878000000000,50.6722000000000,30.1920000000000;-39.9798000000000,55.2601000000000,52.6000000000000;-13.3838000000000,57.9021000000000,64.3320000000000;15.8342000000000,58.4559000000000,64.9920000000000;41.7942000000000,56.2259000000000,51.4990000000000;60.0522000000000,52.0858000000000,28.7080000000000;71.9592000000000,47.1917000000000,2.47500000000000;72.7981000000000,41.8218000000000,-31.0260000000000;-82.9559000000000,13.3203000000000,-30.8080000000000;-80.1139000000000,16.3903000000000,6.85000000000000;-71.2099000000000,20.8203000000000,41.3240000000000;-48.5119000000000,24.5292000000000,69.1360000000000;-17.3439000000000,27.0241000000000,86.9230000000000;18.4181000000000,27.2709000000000,86.4370000000000;49.5481000000000,25.2378000000000,68.4300000000000;73.2191000000000,22.0067000000000,41.2970000000000;81.5801000000000,17.6837000000000,6.56400000000000;83.3711000000000,13.5477000000000,-30.7490000000000;-85.1321000000000,-17.0557000000000,-28.7310000000000;-82.9461000000000,-14.8827000000000,10.0090000000000;-75.2941000000000,-12.6397000000000,47.9040000000000;-51.5811000000000,-10.7548000000000,78.0350000000000;-18.2790000000000,-9.43190000000000,97.3560000000000;19.6780000000000,-9.30410000000000,95.7060000000000;53.8059000000000,-10.1442000000000,77.7300000000000;78.1249000000000,-11.7353000000000,47.8400000000000;85.1369000000000,-13.9063000000000,9.89000000000000;86.0999000000000,-17.0883000000000,-28.7560000000000;-84.8102000000000,-47.2457000000000,-26.2200000000000;-82.7042000000000,-46.2977000000000,11.9740000000000;-73.3012000000000,-46.7917000000000,49.1090000000000;-51.0492000000000,-47.1758000000000,80.0160000000000;-17.3542000000000,-47.3419000000000,97.4100000000000;20.6798000000000,-47.2321000000000,98.0720000000000;53.9968000000000,-46.8902000000000,80.0770000000000;76.5498000000000,-46.3733000000000,49.1400000000000;85.1998000000000,-45.8073000000000,12.1020000000000;85.4428000000000,-47.2213000000000,-26.1760000000000;-72.1773000000000,-74.6277000000000,-21.5360000000000;-70.1133000000000,-74.8677000000000,12.9990000000000;-61.7283000000000,-77.6238000000000,43.0280000000000;-41.6733000000000,-79.7528000000000,66.7150000000000;-13.9613000000000,-81.0029000000000,81.0030000000000;17.2977000000000,-80.9810000000000,81.6410000000000;44.7477000000000,-79.6111000000000,67.6550000000000;63.6267000000000,-77.3022000000000,43.1190000000000;72.1037000000000,-74.4993000000000,13.0250000000000;73.2817000000000,-75.0773000000000,-21.5760000000000;-54.7754000000000,-98.9768000000000,-16.1930000000000;-51.9284000000000,-98.4438000000000,12.3040000000000;-43.3424000000000,-100.162900000000,30.0090000000000;-28.0074000000000,-101.361000000000,42.3790000000000;-9.50340000000000,-102.060000000000,49.4180000000000;10.2356000000000,-102.029000000000,48.9420000000000;28.6476000000000,-101.390100000000,42.1380000000000;44.2206000000000,-100.219100000000,29.8080000000000;52.8386000000000,-98.5360000000000,12.2500000000000;55.8596000000000,-99.8940000000000,-16.2080000000000;-14.8054000000000,-115.100000000000,11.8290000000000;15.1456000000000,-115.191000000000,11.8330000000000;-15.1584000000000,-118.242000000000,-26.0480000000000;15.1286000000000,-118.151000000000,-26.0810000000000;-36.1247000000000,72.3801000000000,-45.8520000000000;-43.5117000000000,78.5802000000000,-9.24000000000000;-33.2847000000000,81.2071000000000,-1.14000000000000;-22.3517000000000,83.5621000000000,6.07100000000000;-12.2417000000000,86.1941000000000,14.1880000000000;0.170300000000000,87.3220000000000,17.4420000000000;13.6223000000000,86.7579000000000,15.3020000000000;24.1013000000000,84.3769000000000,7.43300000000000;33.9133000000000,81.8119000000000,-1.03500000000000;43.9483000000000,79.2958000000000,-9.30000000000000;37.7123000000000,72.1679000000000,-46.1970000000000;-59.3398000000000,52.6802000000000,-48.7700000000000;-63.2618000000000,55.9922000000000,-11.1730000000000;-55.8198000000000,61.3962000000000,11.8840000000000;-43.3817000000000,66.3672000000000,32.8110000000000;-23.5817000000000,69.9171000000000,47.2930000000000;0.276300000000000,71.2800000000000,52.0920000000000;25.5583000000000,70.5559000000000,47.8270000000000;45.1522000000000,67.2748000000000,32.7310000000000;58.0002000000000,62.5998000000000,11.9000000000000;64.6732000000000,57.2738000000000,-11.4600000000000;60.6012000000000,52.2668000000000,-49.0380000000000;-78.4839000000000,28.7703000000000,-50.5220000000000;-76.6149000000000,28.6533000000000,-11.5080000000000;-71.5059000000000,33.9263000000000,20.9930000000000;-55.9399000000000,38.7162000000000,49.7880000000000;-30.6548000000000,42.4151000000000,71.0400000000000;0.351200000000000,44.0740000000000,79.1410000000000;32.6451000000000,43.1009000000000,70.7950000000000;57.5042000000000,39.8518000000000,48.8110000000000;74.2501000000000,35.4997000000000,20.3800000000000;79.0341000000000,30.3437000000000,-11.9970000000000;79.9201000000000,28.9417000000000,-50.9140000000000;-87.3620000000000,-0.514700000000000,-49.8370000000000;-82.6680000000000,-0.941700000000000,-10.2840000000000;-80.1330000000000,2.58530000000000,27.3120000000000;-64.1610000000000,5.83130000000000,60.8850000000000;-35.7490000000000,8.30910000000000,85.4590000000000;0.391100000000000,9.50800000000000,95.5600000000000;36.0700000000000,8.65190000000000,83.8320000000000;65.1640000000000,6.61980000000000,60.0520000000000;81.5440000000000,3.66370000000000,27.2010000000000;83.1680000000000,0.181700000000000,-10.3640000000000;85.3930000000000,-0.952300000000000,-49.5200000000000;-86.6321000000000,-31.2377000000000,-47.1780000000000;-85.9331000000000,-31.0927000000000,-8.47400000000000;-81.5431000000000,-30.1727000000000,30.2730000000000;-66.1281000000000,-29.2957000000000,65.8980000000000;-36.9301000000000,-28.5699000000000,91.7340000000000;0.395900000000000,-28.1630000000000,101.269000000000;38.5399000000000,-28.2251000000000,90.9760000000000;68.8539000000000,-28.6403000000000,66.4100000000000;84.5529000000000,-29.3783000000000,30.8780000000000;85.9999000000000,-30.2803000000000,-8.43500000000000;86.7619000000000,-31.7313000000000,-47.2530000000000;-80.7152000000000,-60.6457000000000,-43.5940000000000;-78.5992000000000,-59.7237000000000,-4.75800000000000;-73.6642000000000,-61.9227000000000,30.3800000000000;-59.4112000000000,-63.9248000000000,62.6720000000000;-32.7283000000000,-65.3199000000000,85.9440000000000;0.365800000000000,-65.7500000000000,94.0580000000000;35.8918000000000,-65.1381000000000,85.9800000000000;62.2558000000000,-63.6152000000000,62.7190000000000;76.6708000000000,-61.5483000000000,30.5430000000000;79.3188000000000,-59.3033000000000,-4.84000000000000;81.5598000000000,-61.2153000000000,-43.8000000000000;-64.5703000000000,-86.4318000000000,-38.3240000000000;-64.5833000000000,-86.2218000000000,0.0330000000000000;-58.7123000000000,-88.7048000000000,25.1930000000000;-46.1603000000000,-90.8878000000000,47.4460000000000;-24.6483000000000,-92.2919000000000,62.0760000000000;0.272700000000000,-92.7580000000000,67.3420000000000;26.4367000000000,-92.2951000000000,63.1990000000000;47.1437000000000,-90.7122000000000,47.6780000000000;60.8127000000000,-88.5042000000000,25.6620000000000;65.1517000000000,-85.9432000000000,-0.00900000000000000;65.0377000000000,-86.7182000000000,-38.4480000000000;-43.1284000000000,-107.516000000000,-32.3870000000000;-42.9764000000000,-106.493000000000,5.77300000000000;-36.2344000000000,-107.716000000000,17.7500000000000;-25.9844000000000,-108.616000000000,26.5440000000000;-13.6644000000000,-109.266000000000,32.8560000000000;0.167600000000000,-109.276000000000,32.7900000000000;13.6506000000000,-109.106000000000,30.9360000000000;26.6636000000000,-108.668000000000,26.4150000000000;37.7006000000000,-107.840000000000,18.0690000000000;43.6696000000000,-106.599000000000,5.72600000000000;43.1766000000000,-107.444000000000,-32.4630000000000;-29.3914000000000,-114.511000000000,-10.0200000000000;0.0525000000000000,-119.343000000000,-3.93600000000000;29.5526000000000,-113.636000000000,-10.0510000000000;-84.1611000000000,-16.0187000000000,-9.34600000000000;-72.4343000000000,-73.4527000000000,-2.48700000000000;85.0799000000000,-15.0203000000000,-9.49000000000000;73.0557000000000,-73.0683000000000,-2.54000000000000;-86.0761000000000,-44.9897000000000,-67.9860000000000;85.7939000000000,-45.0093000000000,-68.0310000000000;-86.0761000000000,-24.9897000000000,-67.9860000000000;85.7939000000000,-25.0093000000000,-68.0310000000000];
% labels={'LPA';'RPA';'Nz';'Fp1';'Fpz';'Fp2';'AF9';'AF7';'AF5';'AF3';'AF1';'AFz';'AF2';'AF4';'AF6';'AF8';'AF10';'F9';'F7';'F5';'F3';'F1';'Fz';'F2';'F4';'F6';'F8';'F10';'FT9';'FT7';'FC5';'FC3';'FC1';'FCz';'FC2';'FC4';'FC6';'FT8';'FT10';'T9';'T7';'C5';'C3';'C1';'Cz';'C2';'C4';'C6';'T8';'T10';'TP9';'TP7';'CP5';'CP3';'CP1';'CPz';'CP2';'CP4';'CP6';'TP8';'TP10';'P9';'P7';'P5';'P3';'P1';'Pz';'P2';'P4';'P6';'P8';'P10';'PO9';'PO7';'PO5';'PO3';'PO1';'POz';'PO2';'PO4';'PO6';'PO8';'PO10';'O1';'Oz';'O2';'I1';'Iz';'I2';'AFp9h';'AFp7h';'AFp5h';'AFp3h';'AFp1h';'AFp2h';'AFp4h';'AFp6h';'AFp8h';'AFp10h';'AFF9h';'AFF7h';'AFF5h';'AFF3h';'AFF1h';'AFF2h';'AFF4h';'AFF6h';'AFF8h';'AFF10h';'FFT9h';'FFT7h';'FFC5h';'FFC3h';'FFC1h';'FFC2h';'FFC4h';'FFC6h';'FFT8h';'FFT10h';'FTT9h';'FTT7h';'FCC5h';'FCC3h';'FCC1h';'FCC2h';'FCC4h';'FCC6h';'FTT8h';'FTT10h';'TTP9h';'TTP7h';'CCP5h';'CCP3h';'CCP1h';'CCP2h';'CCP4h';'CCP6h';'TTP8h';'TTP10h';'TPP9h';'TPP7h';'CPP5h';'CPP3h';'CPP1h';'CPP2h';'CPP4h';'CPP6h';'TPP8h';'TPP10h';'PPO9h';'PPO7h';'PPO5h';'PPO3h';'PPO1h';'PPO2h';'PPO4h';'PPO6h';'PPO8h';'PPO10h';'POO9h';'POO7h';'POO5h';'POO3h';'POO1h';'POO2h';'POO4h';'POO6h';'POO8h';'POO10h';'OI1h';'OI2h';'Fp1h';'Fp2h';'AF9h';'AF7h';'AF5h';'AF3h';'AF1h';'AF2h';'AF4h';'AF6h';'AF8h';'AF10h';'F9h';'F7h';'F5h';'F3h';'F1h';'F2h';'F4h';'F6h';'F8h';'F10h';'FT9h';'FT7h';'FC5h';'FC3h';'FC1h';'FC2h';'FC4h';'FC6h';'FT8h';'FT10h';'T9h';'T7h';'C5h';'C3h';'C1h';'C2h';'C4h';'C6h';'T8h';'T10h';'TP9h';'TP7h';'CP5h';'CP3h';'CP1h';'CP2h';'CP4h';'CP6h';'TP8h';'TP10h';'P9h';'P7h';'P5h';'P3h';'P1h';'P2h';'P4h';'P6h';'P8h';'P10h';'PO9h';'PO7h';'PO5h';'PO3h';'PO1h';'PO2h';'PO4h';'PO6h';'PO8h';'PO10h';'O1h';'O2h';'I1h';'I2h';'AFp9';'AFp7';'AFp5';'AFp3';'AFp1';'AFpz';'AFp2';'AFp4';'AFp6';'AFp8';'AFp10';'AFF9';'AFF7';'AFF5';'AFF3';'AFF1';'AFFz';'AFF2';'AFF4';'AFF6';'AFF8';'AFF10';'FFT9';'FFT7';'FFC5';'FFC3';'FFC1';'FFCz';'FFC2';'FFC4';'FFC6';'FFT8';'FFT10';'FTT9';'FTT7';'FCC5';'FCC3';'FCC1';'FCCz';'FCC2';'FCC4';'FCC6';'FTT8';'FTT10';'TTP9';'TTP7';'CCP5';'CCP3';'CCP1';'CCPz';'CCP2';'CCP4';'CCP6';'TTP8';'TTP10';'TPP9';'TPP7';'CPP5';'CPP3';'CPP1';'CPPz';'CPP2';'CPP4';'CPP6';'TPP8';'TPP10';'PPO9';'PPO7';'PPO5';'PPO3';'PPO1';'PPOz';'PPO2';'PPO4';'PPO6';'PPO8';'PPO10';'POO9';'POO7';'POO5';'POO3';'POO1';'POOz';'POO2';'POO4';'POO6';'POO8';'POO10';'OI1';'OIz';'OI2';'T3';'T5';'T4';'T6';'M1';'M2';'A1';'A2'};
% 
% for ii=1:346
% eegp_opts.EEGP_LEADS.(upper(labels{ii}))=loc(ii,:);
% end

%%
%set lead locations to be from EEGLAB MNI 10-5 system. This code also sets
%the center correctly for laplacian calculation. Added 5/20/11

%modified 11/15/11 to detect EGI array since I think electrode names begin
%with E
if strcmpi('E1',chan(1)) %assuming first channel is E1
    disp('assuming EGI 129 channel array');
    eegp_opts=eegp_defopts_eeglablocsAndy('EGI129');
else
     eegp_opts=eegp_defopts_eeglablocsAndy;%use default channel name list
end
%%
opts.Laplacian_nbrs_interior=4;%11/30/11 tried to improve consistency of shape if channel locations change,default is 4. Doesn't help
% HjorthMatrix=cofl_xtp_makemont(chan(EEG_ch)',[],opts);
 HjorthMatrix=cofl_xtp_makemont(chan(EEG_ch)',[],opts,eegp_opts);%[] means same channels out as goes in. Could change if want to display EMG but not use for laplacian
[a b c]=size(dataOriginal);
data(EEG_ch,:,:)=reshape(HjorthMatrix*reshape(dataOriginal,a,[]),a,b,c); %note convert to 2D matrix for multiplication then convert back.
